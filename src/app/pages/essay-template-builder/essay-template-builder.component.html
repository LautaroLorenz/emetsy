<form
  novalidate
  [formGroup]="form"
>
  <app-page-title
    [title]="title"
    [showBack]="true"
    (backEvent)="exit()"
  >
    <ng-container toolbar-left>
      <div class="ml-3">
        <ng-container formGroupName="essayTemplate">
          <input
            #nameInput
            placeholder="Nombre"
            type="text"
            pInputText
            id="name"
            formControlName="name"
            class="name-input w-15rem"
            [appSelectOnFocus]="true"
            [(appFocused)]="nameInputFocused"
            [ngClass]="{
            'cursor-pointer': !nameInputFocused,
            'border-none': !nameInputFocused && nameInput.value
          }"
          />
        </ng-container>
      </div>
    </ng-container>
    <ng-container toolbar-right>
      <div>
        <p-splitButton
          label="Guardar"
          styleClass="p-button-success"
          [disabled]="saveButtonDisabled"
          [model]="saveButtonMenuItems"
          appendTo="body"
          (onClick)="save()"
        ></p-splitButton>
      </div>
    </ng-container>
  </app-page-title>

  <div class="flex justify-content-evenly">

    <div class="flex flex-1 flex-column pl-3">
      <p class="panel-header-title text-lg pt-1">
        Herramientas
      </p>
      <p-panel
        class="w-full"
        styleClass=""
      >
        <ng-template pTemplate="header">
          Selector de pasos
        </ng-template>
        <div
          *ngIf="(steps$ | async) as steps"
          class="flex flex-column mt-2"
        >
          <div
            *ngFor="let step of steps"
            class="mb-2"
          >
            <p-button
              icon="pi pi-plus"
              styleClass="p-button-outlined w-full text-left"
              [label]="step.name"
              (click)="addEssayTemplateStep(step)"
            ></p-button>
          </div>
        </div>
      </p-panel>
    </div>

    <p-divider layout="vertical"></p-divider>

    <div class="flex flex-1 flex-column">
      <div class="flex pt-3 pb-4 align-items-center justify-content-between">
        <span class="panel-header-title text-lg">Pasos del ensayo</span>
        <div>
          <p-button
            icon="pi pi-arrow-up"
            styleClass="p-button-outlined mr-2"
            [disabled]="buttonMoveUpDisabled"
            [tooltipDisabled]="buttonMoveUpDisabled"
            pTooltip="Subir posición"
            tooltipPosition="bottom"
            [showDelay]="1250"
            (click)="moveUpByIndex(selectedIndex)"
          ></p-button>
          <p-button
            icon="pi pi-arrow-down"
            styleClass="p-button-outlined mr-2"
            [disabled]="buttonMoveDownDisabled"
            [tooltipDisabled]="buttonMoveDownDisabled"
            pTooltip="Bajar posición"
            tooltipPosition="bottom"
            [showDelay]="1250"
            (click)="moveDownByIndex(selectedIndex)"
          ></p-button>
          <p-button
            icon="pi pi-times"
            styleClass="p-button-outlined p-button-danger"
            [disabled]="buttonRemoveDisabled"
            [tooltipDisabled]="buttonRemoveDisabled"
            pTooltip="Eliminar"
            tooltipPosition="bottom"
            [showDelay]="1250"
            (click)="stepRemoveByIndex(selectedIndex)"
          ></p-button>
        </div>
      </div>
      <div
        class="flex flex-1 flex-column max-h-30rem overflow-auto"
        formArrayName="essayTemplateSteps"
      >
        <ng-container
          *ngFor="let essayTemplateStepControl of getEssaytemplateStepControls().controls; let i = index"
        >
          <p-panel
            id="panel-index-{{i}}"
            class="w-full"
            styleClass="mb-2 mx-1 cursor-pointer select-none"
            (click)="selectIndex(i)"
            [ngClass]="{
              'essay-template-step-selected': i === selectedIndex
            }"
          >
            <ng-template pTemplate="header">
              <div
                class="custom-header flex flex-1 align-items-center justify-content-between"
              >
                {{essayTemplateStepControl.value.foreign.step.name}}
              </div>
            </ng-template>
          </p-panel>
        </ng-container>
      </div>
    </div>

    <p-divider layout="vertical"></p-divider>

    <div class="flex flex-1 flex-column pr-3 pt-1">
      <p class="panel-header-title text-lg">
        Administración del paso selccionado
      </p>
      <p-panel
        class="w-full"
        styleClass=""
      >
        <ng-template pTemplate="header">
          ....
        </ng-template>
        <!-- TODO: -->
      </p-panel>
    </div>

  </div>
</form>