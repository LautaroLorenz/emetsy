<form
  novalidate
  [formGroup]="form"
  class=""
>
  <app-page-title
    [title]="title"
    [showBack]="true"
    (backEvent)="exit()"
  >
    <ng-container toolbar-left>
      <div class="ml-3">
        <ng-container formGroupName="essayTemplate">
          <input
            #nameInput
            placeholder="Nombre"
            type="text"
            pInputText
            id="name"
            formControlName="name"
            class="name-input w-15rem"
            [appSelectOnFocus]="true"
            [(appFocused)]="nameInputFocused"
            [ngClass]="{
              'cursor-pointer': !nameInputFocused,
              'border-none': !nameInputFocused && nameInput.value
            }"
          />
        </ng-container>
      </div>
    </ng-container>
    <ng-container toolbar-right>
      <div>
        <p-splitButton
          label="Guardar"
          styleClass="p-button-success"
          [disabled]="saveButtonDisabled"
          [model]="saveButtonMenuItems"
          appendTo="body"
          (onClick)="save()"
        ></p-splitButton>
      </div>
    </ng-container>
  </app-page-title>

  <app-fill-available-space class="flex justify-content-evenly">

    <div class="flex flex-1 flex-column pl-3">
      <p class="panel-header-title text-lg text-700">
        Herramientas
      </p>
      <p-panel
        class="w-full"
        styleClass="shadow-none"
      >
        <ng-template pTemplate="header">
          Selector de pasos
        </ng-template>
        <ng-container *ngIf="(steps$ | async) as steps">
          <app-step-selector
            [steps]="steps"
            (stepSelected)="addEssayTemplateStep($event)"
          ></app-step-selector>
        </ng-container>
      </p-panel>
    </div>

    <p-divider layout="vertical"></p-divider>

    <div class="flex flex-1 flex-column">
      <ng-container
        *ngIf="getEssaytemplateStepControls() as essatTemplateStepsArrayForm"
      >
        <app-form-array-controls-order-list
          headerText="Listado de pasos"
          [(selectedIndex)]="selectedIndex"
          [scrollToIndex]="scrollToIndex"
          [arrayOfControls]="essatTemplateStepsArrayForm"
          [itemHeaderTemplate]="itemHeaderTemplate"
          (onChanges)="form.markAsDirty()"
        >
          <ng-template
            #itemHeaderTemplate
            let-controlValue="controlValue"
            let-index="index"
          >
            <div
              class="custom-header flex flex-1 align-items-center justify-content-between"
            >
              <span>{{controlValue.foreign.step.name}}</span>
              <!-- <span>{{index+1}}</span> TODO: mostrar el orden -->
            </div>
          </ng-template>
        </app-form-array-controls-order-list>
      </ng-container>
    </div>

    <p-divider layout="vertical"></p-divider>

    <div class="flex flex-1 flex-column pr-3 pt-1">
      <ng-container *ngIf="hasSelectedIndex">
        <p
          class="panel-header-title text-lg pb-2 border-bottom-3 border-pink-300 text-700">
          {{selectedControl?.value.foreign.step.name}}
        </p>
        ...
        <!-- TODO: Acciones del paso -->
      </ng-container>
    </div>

  </app-fill-available-space>
</form>